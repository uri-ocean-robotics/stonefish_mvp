<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Robots &mdash; Stonefish MVP 1.3.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/tooltipster.custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/tooltipster.bundle.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/tooltipster-sideTip-shadow.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/tooltipster-sideTip-punk.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/tooltipster-sideTip-noir.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/tooltipster-sideTip-light.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/tooltipster-sideTip-borderless.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/micromodal.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/sphinx_rtd_theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/js/hoverxref.js"></script>
        <script src="_static/js/tooltipster.bundle.min.js"></script>
        <script src="_static/js/micromodal.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Actuators" href="actuators.html" />
    <link rel="prev" title="Defining scenarios" href="parser.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #016A91" >
            <a href="index.html">
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="parser.html">Defining scenarios</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Robots</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#joint-state">Joint state</a></li>
<li class="toctree-l2"><a class="reference internal" href="#servo-setpoints">Servo setpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="#thrusters">Thrusters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="actuators.html">Actuators</a></li>
<li class="toctree-l1"><a class="reference internal" href="sensors.html">Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #016A91" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Stonefish MVP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Robots</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/robots.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="robots">
<span id="id1"></span><h1>Robots<a class="headerlink" href="#robots" title="Permalink to this heading"></a></h1>
<p>The definition of robots is one of the key features of the <em>Stonefish</em> library. Each robot is constructed from dynamic bodies, connected through joints (kinematic tree). Then it is equipped with sensors and actuators. All details on creating robots using the XML syntax are explained in the <em>Stonefish</em> documentation. Only parser extensions implemented for the integration of <em>Stonefish</em> and ROS are described here.</p>
<p>When creating a robot in the simulation scenario, it is typical to attach various actuators to its joints and links.
Most commonly used actuators for underwater robots include servos and thrusters. A simple extension of the XML syntax, presented below, was developed to deal with both of these actuator types. Other types of actuators and all types of sensors and communication devices are treated separately (see following chapters of the documentation).</p>
<div class="section" id="joint-state">
<span id="id2"></span><h2>Joint state<a class="headerlink" href="#joint-state" title="Permalink to this heading"></a></h2>
<p>The joint state of the robot can be retrieved in two ways, by reading it from the servo actuators or from the attached rotary encoders. The first option works for all actively driven joints, as the user has to define servos for these joints, to be able to move them. The second option requires separate definition of an encoder for each of the joints. The standard approach is the first one and the second one can be used in case of robots with passive links. The <em>stonefish_ros</em> package greatly simplifies reading the joint state of the whole robot, by introducing a single definition, enabling the standard joint state publisher, automatically gathering data from all defined servo actuators:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;...&quot;</span><span class="w"> </span><span class="na">fixed=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- all standard robot definitions --&gt;</span>
<span class="w">    </span><span class="nt">&lt;ros_publisher</span><span class="w"> </span><span class="na">servos=</span><span class="s">&quot;/my_joint_state&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>The joint state is published using the standard ROS message of type <code class="docutils literal notranslate"><span class="pre">sensor_msgs/JointState</span></code>. With the number of elements in the vectors equal to the number of servo actuators attached to the robot. The names of the joints are filled based on the defined robot name and joint names, e.g., <code class="docutils literal notranslate"><span class="pre">robot_name/joint1_name</span></code>.</p>
</div>
<div class="section" id="servo-setpoints">
<h2>Servo setpoints<a class="headerlink" href="#servo-setpoints" title="Permalink to this heading"></a></h2>
<p>Equally important as retrieving the joint state, is updating the actuators’ setpoints. Similarly to the mechanism described above, a single definition is needed to enable the standard servo setpoint subscriber, which automatically applies new setpoints to all of the robot’s servo actuators:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;...&quot;</span><span class="w"> </span><span class="na">fixed=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- all standard robot definitions --&gt;</span>
<span class="w">    </span><span class="nt">&lt;ros_subscriber</span><span class="w"> </span><span class="na">servos=</span><span class="s">&quot;/my_joint_setpoints&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>The setpoints are expected to be published using the standard ROS message type <code class="docutils literal notranslate"><span class="pre">sensor_msgs/JointState</span></code>. The <em>stonefish_ros</em> package identifies the servo actuators, to which the setpoints should be applied to, by their names (see <a class="reference internal" href="#joint-state"><span class="std std-ref">Joint state</span></a>). Moreover, <strong>two control modes</strong> are implemented: <strong>position</strong> and <strong>velocity</strong>. The mode is automatically detected by checking the size of the position and velocity vectors, defined in the message, i.e., if the user wants to use position mode, only the position vector should be filled.</p>
</div>
<div class="section" id="thrusters">
<h2>Thrusters<a class="headerlink" href="#thrusters" title="Permalink to this heading"></a></h2>
<p>Similarly to the servo actuators the <em>stonefish_ros</em> package automatically aggregates information for all thrusters defined within a robot. A single definition is needed to enable the standard thruster setpoint subscriber:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;...&quot;</span><span class="w"> </span><span class="na">fixed=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- all standard robot definitions --&gt;</span>
<span class="w">    </span><span class="nt">&lt;ros_subscriber</span><span class="w"> </span><span class="na">thrusters=</span><span class="s">&quot;/my_thruster_setpoints&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>The setpoints are expected to be published using a message of type <code class="docutils literal notranslate"><span class="pre">cola2_msgs/Setpoints</span></code>, containing a vector of values with a size corresponding to the number of defined thrusters. Each of the <strong>setpoints</strong>, proportional to the desired rotational velocity of the propeller, is expected to be <strong>between -1 and 1</strong>. The value of 0 naturally corresponds to a stopped propeller, while the value of 1 corresponds to the maximum rotational velocity, specified during the actuator definition. The sign of the setpoint corresponds to the propeller’s rotation direction. Additionally, <em>stonefish_ros</em> package implements automatic publishing of thruster state, using a custom message type <code class="docutils literal notranslate"><span class="pre">stonefish_ros/ThrusterState</span></code>. The contents of the message include the current thruster setpoints, the rotational velocities of the propellers, and the generated thrusts and torques. Enabling the thruster state publisher requires a following definition:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;robot</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;...&quot;</span><span class="w"> </span><span class="na">fixed=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- all standard robot definitions --&gt;</span>
<span class="w">    </span><span class="nt">&lt;ros_publisher</span><span class="w"> </span><span class="na">thrusters=</span><span class="s">&quot;/my_thruster_state&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When a robot is equipped both with servos and thrusters, the topic definitions have to be aggregated as attributes of the same <code class="docutils literal notranslate"><span class="pre">ros_publisher</span></code> and <code class="docutils literal notranslate"><span class="pre">ros_subscriber</span></code> tags.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="parser.html" class="btn btn-neutral float-left" title="Defining scenarios" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="actuators.html" class="btn btn-neutral float-right" title="Actuators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Patryk Cieślak.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>